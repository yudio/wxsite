
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="Keywords" content="微盟、微信营销、微信代运营、微信定制开发、微信托管、微网站、微商城、微营销" />
        <meta name="Description" content="微盟，国内最大的微信公众智能服务平台，微盟八大微体系：微菜单、微官网、微会员、微活动、微商城、微推送、微服务、微统计，企业微营销必备。" />
        <link rel="shortcut icon" href="img/favicon.ico?v=2014-02-24-4" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap_min.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap_responsive_min.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/style.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/plugins/daterangepicker/daterangepicker.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/todc_bootstrap_button.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/plugins/chosen/chosen.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/themes.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/inside.css?2014-02-24-4" media="all" />
		<script type="text/javascript" src="src/jQuery.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/bootstrap_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/validation/jquery_validate_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/validation/jquery_validate_methods.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/form/jquery_form_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/daterangepicker/moment_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/daterangepicker/daterangepicker.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/inside.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/insert_text.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/chosen/chosen_jquery_min.js?2014-02-24-4"></script>
		<title>微盟（Weimob）—国内最大的微信公众服务平台</title>
        <!--[if IE 7]>
            <link href="css/font_awesome_ie7.css?v=2014-02-24-4" rel="stylesheet" />
        <![endif]-->
        <!--[if lte IE 8]>
            <script src="js/excanvas_min.js?v=2014-02-24-4"></script>
        <![endif]-->
        <!--[if lte IE 9]>
            <script src="js/watermark.js?v=2014-02-24-4"></script>
        <![endif]-->
    </head>
    <div id="main">
	<div class="container-fluid">
		<div class="row-fluid">
			<div class="span12">
				<div class="box">
					<div class="box-title">
						<div class="span10">
							<h3><i class="icon-edit"></i>添加开卡即送</h3>
						</div>
					</div>

					<div class="box-content">
						<form action="/newmembercard/EditCardGift" method="post" class="form-horizontal form-validate">
							<input type="hidden" name="aid" value="74461"/>
							<input type="hidden" name="id" value=""/>
							<div class="control-group">
								<label for="title" class="control-label">活动名称：</label>
								<div class="controls">
									<input type="text" name="title" id="title" value="" class="input-large" data-rule-required="true" /><span class="maroon">*</span>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="time">活动时间</label>
								<div class="controls">
									<div class="input-prepend">
										<span class="add-on"><i class="icon-calendar"></i></span>
										<input type="text" name="time" readonly="" id="time"  class="daterangepick input-xlarge" data-rule-required="true" />
									</div>
									<span class="maroon">*</span>
								</div>
							</div>

							<div class="control-group">
								<label class="control-label" for="time">活动策略</label>
								<div class="controls" id="quan">
									<label class="radio">
																				<input type="radio" name="type" value="0"  checked="checked" data-ty="jifen" />开卡赠送积分<span class="help-inline">
										<input type="text" name="dmoney" id="dmoneyd"  value="" class="input-mini" data-rule-positiveInteger="true" />分</span>
									</label>
									<label class="radio inline ">
										<input type="radio" name="type" value="1"  data-ty="quan" />开卡赠送优惠券 
									</label>
									<button type="button" class="btn  inline add_quan" disabled="disabled">
										<span class="icon-plus" title=""></span>再增加条
									</button>
																		<div class="row-fluid margin-top10 qaun_row">
										<select name="ticket_ty[0]" class="input-small ticket_ty" id="ticket_ty0" data-rule-required="true" data-selected="" disabled="disabled">
										</select>
										<select name="ticket_id[0]" class="input-medium ticket_id" id="ticket_id0" data-rule-required="true" data-selected="" disabled="disabled">
										</select>
										<button class="btn del btn-mini" type="button" style="display:none;">
											<span class="icon-remove"></span>
										</button>
									</div>
																	</div>
							</div>
						   <div class="control-group">
								<label class="control-label" for="info">营销</label>
								<div class="controls">
									<label class="checkbox">
										<input type="checkbox" value="1" 0 name="ck_description" id="ck_description" />在用户领卡界面展示
									</label>
									<textarea class="input-xlarge __description hide" rows="3" name="description" id="description" placeholder="请输入活动说明" data-rule-required="true"></textarea>
								</div>
							</div>
							<div class="control-group">
								<label class="control-label" for="info">短信通知</label>
								<div class="controls">
									<label class="checkbox">
										<input type="checkbox" value="1" 0 name="ck_msg" id="ck_msg" />需要以短信形式将开卡赠送的优惠告知会员
									</label>
								</div>
							</div>
							<div class="control-group __msg">
								<label class="control-label" for="send_number">发送预览</label>
								<div class="controls">
									<input class="input-xlarge" id="send_number" type="text" placeholder="多个号码用,分开" />
									<span class="help-inline"><a href="javascript:;" class="btn" id="send_msg" data-loading-text="发送中...">发送</a></span>
								</div>
							</div>
							<div class="form-actions">
								<button id="bsubmit" type="submit" data-loading-text="提交中..." class="btn btn-primary">保存</button>
								<button type="button" class="btn" onclick="Javascript:window.history.go(-1)">取消</button>
							</div>
						</form>
					</div>
				</div>
			</div>

		</div>
	</div>
</div>
<script type="text/javascript">
	$(function () {
		$info = $("#info");
		$("a.add_par").click(function () {
			console.log($(this).data("value"));
			$info.insertAtCaret($(this).data("value"));
		})
		$info.setCaret();
		$info.live("keydown keyup blur", function (e) {
			var content = $(this).val();
			var length = content.length;
			var $words = $("span.words"), $number = $("span.number");
			$words.text(length)
			var f = Math.floor(length / 70) + 1;
			$number.text(f);
		});
		var $show = "";
		if($show==1){
			var $this = $(":checkbox[name='ck_description']:checked");          	
			$(".__description").toggle(this.checked)
		}
		$("#ck_description").click(function () {
			$(".__description").toggle(this.checked)
		})

		$(":radio[name='type']").click(function () {
			var $this = $(this);
			var $ty = $this.data("ty");
			var $quan = $("#quan");
			var $$jifen = $quan.find("input[type=text]");
			var $$quan = $quan.find(".btn,select");
			if ($ty == "jifen") {
				$$jifen.removeAttr("disabled");
				$$quan.attr("disabled", "disabled");
			} else {
				$$quan.removeAttr("disabled");
				$$jifen.attr("disabled", "disabled");
			}
		});
		var $is_sms = "";
		if($is_sms==0){
			var $this = $(":checkbox[name='ck_msg']:checked");          	
			$(".__msg").toggle(this.checked)
		}
		$("#ck_msg").click(function () {
			$(".__msg").toggle(this.checked)

		})
		$("div.qaun_row").each(function () {
			var $this = $(this);
			var options = {
				ajax: '/Newmemrecharge/getConsumptiontype?aid=74461'
			};
			var sel = new G.util.select(options);
			var $a1_id = $("select.ticket_ty", $this).attr("id");
			var $a2_id = $("select.ticket_id", $this).attr("id");
			sel.bind("#" + $a1_id);
			sel.bind("#" + $a2_id);

		});
		//券 
		var $index = 0;
		/*
		var _tmp = ' <div class="row-fluid margin-top10 qaun_row">'
				 + '<select name="add_ticket_ty[{0}]"  class="input-small add_ticket_ty" id="add_ticket_ty{0}" data-rule-required="true" ></select> '
				 + '<select name="add_ticket_id[{0}]"  class="input-medium add_ticket_id" id="add_ticket_id{0}" data-rule-required="true" > </select>  <button class="btn del btn-mini" type="button"><span class="icon-remove"></span></button></div>';
		*/
		$("button.add_quan").click(function () {
			if ($("div.qaun_row").length > 2) {
				G.ui.tips.info("最多添加三个优惠"); 
			}else {
				//console.log($("div.qaun_row").length);
				$index++;
				$("div .qaun_row:first").clone(false).appendTo("#quan").children("select").val("").next("button").show();
				$("div .qaun_row:last").children(".ticket_ty").attr('id','ticket_ty' + $index).attr('name','ticket_ty[' + $index + ']').attr('data-selected','');
				$("div .qaun_row:last").children(".ticket_id").attr('id','ticket_id' + $index).attr('name','ticket_id[' + $index + ']').attr('data-selected','');
				var options = {
					ajax: '/Newmemrecharge/getConsumptiontype?aid=74461'
				};
				
				var sel = new G.util.select(options);
				sel.bind('#' + 'ticket_ty' + $index);
				sel.bind('#' + 'ticket_id' + $index);
			}
		})
		$("button.del").live("click", function () {
			if ($("div.qaun_row").length > 1) {
				$(this).parents(".qaun_row").remove();
			} else {
				G.ui.tips.info("最少保留一个优惠券");
			}
		});
		var s = $("#send_msg");
		s.click(function () {
			var n = $("#send_number").val(), t = $("#title").val();
			if (n.length > 0 && t.length > 0) {
				s.button('loading');
				$.ajax({
					url: "/newmembercard/SentMessage",
					type: "post",
					dataType: 'json',
					data: {
						"type":11,
	                    "aid": "74461",
	                    "title": t,
	                    "number": n
					},
					success: function (data) {
						G.logic.form.tip(data);//和页面提交返回参数相同
						s.button('reset');
					},
					error: function () {
						G.ui.tips.info("网络异常请重试..")
					}
				});

			} else { G.ui.tips.info("请输入手机号码和活动名称") }
		});
	})
</script>	
<script>
		window.document.onkeydown = function(e) {
			if ('' == document.activeElement.id) {
				var e=e || event;
　 				var currKey=e.keyCode || e.which || e.charCode;
				if (8 == currKey) {
					return false;
				}
			}
		};
	</script>
</html>