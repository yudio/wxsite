
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="{np::C('Keywords')}" name="Keywords">
	<meta content="{np::C('Description')}" name="Description">
    <link rel="stylesheet" type="text/css" href="css/bootstrap_min.css?2014-02-24-4" media="all" />
	<link rel="stylesheet" type="text/css" href="css/bootstrap_responsive_min.css?2014-02-24-4" media="all" />
	<link rel="stylesheet" type="text/css" href="css/style.css?2014-02-24-4" media="all" />
	<link rel="stylesheet" type="text/css" href="css/todc_bootstrap.css?2014-02-24-4" media="all" />
	<link rel="stylesheet" type="text/css" href="css/plugins/chosen/chosen.css?2014-02-24-4" media="all" />
	<link rel="stylesheet" type="text/css" href="css/themes.css?2014-02-24-4" media="all" />
	<link rel="stylesheet" type="text/css" href="css/inside.css?2014-02-24-4" media="all" />
	<script type="text/javascript" src="src/jQuery.js?2014-02-24-4"></script>
	<script type="text/javascript" src="src/bootstrap_min.js?2014-02-24-4"></script>
	<script type="text/javascript" src="src/plugins/validation/jquery_validate_min.js?2014-02-24-4"></script>
	<script type="text/javascript" src="src/plugins/validation/jquery_validate_methods.js?2014-02-24-4"></script>
	<script type="text/javascript" src="src/plugins/form/jquery_form_min.js?2014-02-24-4"></script>
	<script type="text/javascript" src="src/plugins/chosen/chosen_jquery_min.js?2014-02-24-4"></script>
	<script type="text/javascript" src="src/inside.js?2014-02-24-4"></script>
	<title>{np::C('site_name')}—{np::C('site_title')}</title>
	<link rel="shortcut icon" href="{np::STATICS}/img/favicon.ico" />
    <!--[if lte IE 9]><script src="src/watermark.js"></script><![endif]-->
	<!--[if IE 7]><link href="css/font_awesome_ie7.css" rel="stylesheet" /><![endif]-->
</head>
<body>
	<div id="main">
	<div class="container-fluid">

		<div class="row-fluid">
			<div class="span12">
				<div class="box">
					<div class="box-title">
						<h3><i class="icon-edit"></i>会员交易</h3>
					</div>
					<div class="box-content block-tiles block-tiles-animated">
						<div class="row-fluid">
							<h5>快捷交易</h5>
							<a href="#myModal3" data-toggle="modal" class="tile tile-themed">
								<i class="icon-usd"></i>
								<div class="tile-info"><strong>消费</strong></div>
							</a>
							<a href="#myModal2" data-toggle="modal" class="tile tile-themed">
								<i class="icon-yen"></i>
								<div class="tile-info">
									<strong>充值</strong>
								</div>
							</a>
							<a href="#myModal4" data-toggle="modal" class="tile tile-themed">
								<i class="icon-money"></i>
								<div class="tile-info"><strong>手动修改积分</strong></div>
							</a>
							<a href="#myModal5" data-toggle="modal" class="tile tile-themed">
								<i class="icon-gift"></i>
								<div class="tile-info"><strong>礼品券兑换</strong></div>
							</a>

						</div>
						<div class="row-fluid">
							<h5>交易统计</h5>
							<a href="/Newmembertrade/statisticConsumption?aid=74461" class="tile tile-themed">
								<i class="icon-bar-chart"></i>
								<div class="tile-info"><strong>消费统计</strong></div>
							</a>
							<a href="/Newmembertrade/statisticIntegral?aid=74461" class="tile tile-themed">
								<i class="icon-bar-chart"></i>
								<div class="tile-info"><strong>积分统计</strong></div>
							</a>
						</div>
						<div class="row-fluid">
							<h5>交易明细查询</h5>
							<a href="/Newmembertrade/showConsumptionList?aid=74461" class="tile tile-themed">
								<i class="icon-search"></i>
								<div class="tile-info"><strong>消费查询</strong></div>
							</a>
							<a href="/Newmembertrade/showRechargeList?aid=74461" class="tile tile-themed">
								<i class="icon-search"></i>
								<div class="tile-info"><strong>充值查询</strong></div>
							</a>
							<a href="/Newmembertrade/showIntegerLogList?aid=74461" class="tile tile-themed">
								<i class="icon-search"></i>
								<div class="tile-info"><strong>积分查询</strong></div>
							</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
<div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="Form1" action="/newmembertrade/recharge" method="post" class="form-horizontal form-validate form-modal">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title"><i class="icon-check"></i>会员充值</h4>
				</div>
				<div class="modal-body">
					<div class="control-group">
						<label class="control-label">
							<select name="key_ty" class="input-small-s chosen-select key-ty" data-nosearch="true">
								<option value="cardnumber">会员卡号</option>
								<option value="phone" selected="selected">手机号码</option>
							</select>
						</label>
						<div class="controls">
							<input type="text" class="input-medium key" name="key" data-rule-required="true" />
							<input type="hidden" id="aid" name="aid" value="74461"/>
							<input type="hidden" id="urls" name="urls" value="/Newmembertrade/Index?aid=74461"/>

							<input type="hidden" class="memberid" name="memberid" />

						</div>
					</div>

					<div class="control-group">
	<label class="control-label" for="price">充值金额</label>
	<div class="controls">
		<div class="input-append">
			<input type="text" placeholder="金额" name="price" id="price" class="input-small" data-rule-required="true" data-rule-number="true" />
			<span class="add-on"><i class="icon-cny"></i></span>
		</div>
	</div>
</div>
<div class="control-group">
	<label class="control-label" for="price">充值门店</label>
	<div class="controls">
		<select name="spoutlet_id" class="input-medium chosen-select" data-rule-required="true" data-placeholder="选择门店" data-tips="true">
			<option selected="selected" value="0" >商户总部</option>
					</select>
	</div>
</div>
<div class="control-group">
	<label class="control-label" for="price">操作员</label>
	<div class="controls">
		<input class="input-medium" type="text" placeholder="请填写操作员名称" name="nick" />
	</div>
</div>
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary">提交</button>
					<button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">取消</button>
				</div>
			</form>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<div id="myModal3" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="Form2" action="/newmembertrade/Consume" method="post" class="form-horizontal form-validate form-modal">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title"><i class="icon-check"></i>会员消费</h4>
				</div>
				<div class="modal-body">
					<div class="control-group">
						<label class="control-label">
							<select name="key_ty" class="input-small-s chosen-select key-ty" data-nosearch="true">
								<option value="cardnumber">会员卡号</option>
								<option value="phone" selected="selected">手机号码</option>
							</select>
						</label>
						<div class="controls">
							<input type="text" class="input-medium key" name="key" data-rule-required="true" placeholder="卡号110 存在会员" />
							<input type="hidden" id="aid" name="aid" value="74461"/>
							<input type="hidden" id="urls" name="urls" value="/Newmembertrade/Index?aid=74461"/>
							<input type="hidden" class="memberid" name="memberid" />
						</div>
					</div>

					<div class="control-group">
	<label class="control-label" for="money">消费金额</label>
	<div class="controls">
		<div class="input-append">
			<input type="text" placeholder="金额" name="money" id="money" class="input-small" data-rule-required="true" data-rule-number="true" />
			<span class="add-on"><i class="icon-cny"></i></span>
		</div>
	</div>
</div>

<!--<div class="control-group select_coupon hide" >
	<label class="control-label" for="money">请选择我的优惠券</label>
	<div class="controls">
		<select name="ticket_id" id="ticket_id" class="input-medium" data-rule-required="true">
		</select>
	</div>
</div>-->

<div class="control-group select_coupon hide">
	<label class="control-label" for="money">请选择我的优惠</label>
	<div class="controls">
		<select name="ticket_ty" id="ticket_ty" class="input-small" data-rule-required="true">
		</select>
		<select name="ticket_id" id="ticket_id" class="input-medium">
		</select>
	</div>
</div>

<div class="control-group">
	<label class="control-label" for="money">支付方式</label>
	<div class="controls">
		<select name="but_ty" class="input-medium" data-rule-required="true" data-rule-number="true">
			<option value="">请选择消费方式</option>
			<option value="2">会员卡余额消费</option>
			<option value="1">现金或POS机消费</option>
		</select>
	</div>
</div>
<div class="control-group">
	<label class="control-label" for="price">消费门店</label>
	<div class="controls">
		<select name="spoutlet_id" class="input-medium chosen-select" data-rule-required="true">
			<option selected="selected" value="0" >商户总部</option>
					</select>
	</div>
</div>
<div class="control-group">
	<label class="control-label" for="price">消费密码</label>
	<div class="controls">
		<input class="input-medium" type="text" placeholder="请输入消费密码" name="password" data-rule-required="true" id="password" />
	</div>
</div>

</div>
<!--<script type="text/javascript">-->
<!---->
<!--	var $$memberid = G.string.Empty;-->
<!--	var options = {-->
<!--		ajax: '/Newmembertrade/getConsumptiontype?aid=--><!--&memberid={0}'.format($$memberid),-->
<!--		auto: true,-->
<!--		default_text:"不使用"-->
<!--	};-->
<!---->
<!--	var sel = new G.util.select(options);-->
<!--	sel.bind('#ticket_ty');-->
<!--	sel.bind('#ticket_id');-->
<!--</script>-->
				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary">提交</button>
					<button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">取消</button>

				</div>
			</form>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<div id="myModal4" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="Form3" action="/newmembertrade/Integral" method="post" class="form-horizontal form-validate form-modal">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title"><i class="icon-check"></i>手动修改积分</h4>
				</div>
				<div class="modal-body">
					<div class="control-group">
						<label class="control-label">
							<select id="pont_key_ty" name="key_ty" class="input-small-s chosen-select key-ty" data-nosearch="true">
								<option value="cardnumber">会员卡号</option>
								<option value="phone" selected="selected">手机号码</option>
							</select>
						</label>
						<div class="controls">
							<input type="text" class="input-medium key" name="key" data-rule-required="true" />
							<input type="hidden" class="memberid" name="memberid" />
							<input type="hidden" id="aid" name="aid" value="74461"/>
							<input type="hidden" id="urls" name="urls" value="/Newmembertrade/Index?aid=74461"/>
						</div>
					</div>
					<!--    <div class="control-group">
						<label class="control-label" for="price">修改类型 </label>
						<div class="controls ">
							<label class="radio inline">
								<input type="radio" name="up_ty" value="1" checked="checked">增加
							</label>
							<label class="radio inline">
								<input type="radio" name="up_ty" value="2">扣除
							</label>
						</div>
					</div>-->
					<div class="control-group">
	<label class="control-label" for="price">修改积分(增减)</label>
	<div class="controls">
		<input type="text" placeholder="积分" name="score" id="Text1" class="input-small" data-rule-required="true" data-rule-number="true" /><span class="help-block"> 输入500,则标识增加500;输入-500则表示减少500</span>
	</div>
</div>
<div class="control-group">
	<label class="control-label" for="price">修改门店</label>
	<div class="controls">
		<select name="spoutlet_id" class="input-medium chosen-select" data-rule-required="true" data-placeholder="选择门店" data-tips="true">
			<option selected="selected" value="0" >商户总部</option>
					</select>
	</div>
</div>
<div class="control-group">
	<label class="control-label" for="price">操作员</label>
	<div class="controls">
		<input class="input-medium" type="text" placeholder="请填写操作员名称" name="nick" />
	</div>
</div>				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary">提交</button>
					<button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">取消</button>

				</div>
			</form>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>
<div id="myModal5" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form id="Form4" action="/newmembertrade/Exchange_gifts" method="post" class="form-horizontal form-validate form-modal">
				<input type="hidden" id="aid" name="aid" value="74461"/>
				<input type="hidden" id="urls" name="urls" value="/Newmembertrade/Index?aid=74461"/>
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					<h4 class="modal-title"><i class="icon-check"></i>礼品券兑换</h4>
				</div>
				<div class="modal-body">

					<div class="control-group">
						<label class="control-label" for="price">礼品券SN码</label>
						<div class="controls">
							<input type="text" placeholder="请输入SN码" name="sn" id="Text1" class="input-medium" data-rule-required="true"  />
						</div>
					</div>

				</div>
				<div class="modal-footer">
					<button type="submit" class="btn btn-primary">提交</button>
					<button type="button" class="btn btn-default" data-dismiss="modal" aria-hidden="true">取消</button>

				</div>
			</form>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal-dialog -->
</div>

<script type="text/javascript">
	var __memberid = null;
	var __ty = null;
	var __tips = null;
	$(function () {

		
		
		$('div.modal').on('show', function () {
			if (__memberid && __ty) {
				var $this = $(this);
				$("select.key-ty option[value='" + __ty + "']", $this).attr("selected", true).trigger("liszt:updated")
				$("input.key", $this).val(__memberid);
				$("input.memberid", $this).val(__memberid);
				$("span.tips", $this).text(__tips);
				$("button[type=submit]", $this).removeAttr("disabled");
			}
		})
		$("select.key-ty").change(function () {
			var $this = $(this), $g = $this.parents(".control-group");
			var $t = $g.find(".key").val();
			if ($t.length > 0) {
				query_user($g, $t);
			}
		});
		$("input.key").after('<span class="help-inline tips"></span>')
		$("input.key").on("blur", function () {
			var $this = $(this), $t = $this.val();
			var $g = $this.parents(".control-group");
			query_user($g, $t);
		});

		 
		
		function query_user($g, $t) {
			var $ty = $g.find(".key-ty").val();
			var $memberid = $g.find(".memberid");
			var btn = $("button[type=submit]", $g.parents("form")),
			$select_coupon=$("div.select_coupon");
			$.ajax("/newmembertrade/getmember", {
				type: "post", dataType: "json",
				data: { "aid": 74461, "method": "user_query", "username": $t, "ty": $ty }
			}).done(function (d) {
				var $tips = $g.find(".tips");
				if (d.name) {
					$g.removeClass("error")
					var tt = "会员：{0}".format(d.name);
					$tips.text(tt);
					__tips = tt;
					$memberid.val(d.id);

					$select_coupon.show();
					var options = {
						ajax: '/Newmembertrade/getConsumptiontype?aid=74461&memberid={0}'.format(d.id),
						auto: true,
						default_text:"不使用"
					};
					var sel = new G.util.select(options);
					sel.bind('#ticket_ty');
					sel.bind('#ticket_id');


					btn.removeAttr("disabled");
					__memberid = $t;
					__ty = $ty;
				} else {
					$select_coupon.show();
					$g.addClass("error")
					$tips.text("找不到此会员");
					$memberid.val("");
					btn.attr("disabled", "disabled");
					__memberid = null;
					__ty = null;
					__tips = null;
				}
			}).fail(function () { G.ui.tips.err("网络异常 请重试") });
		}

		$("#pont_key_ty option[value='phone']").attr("selected" ,true); 
	})
</script>

</body>
</html>
