
<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="Keywords" content="奈斯、奈斯伙伴、微信营销、微信代运营、微信定制开发、微信托管、微网站、微商城、微营销" />
        <meta name="Description" content="奈斯伙伴，福建最大的微信公众智能服务平台，八大微信利器：微菜单、微官网、微会员、微活动、微商城、微推送、微服务、微统计，企业微营销必备。" />
        <link rel="shortcut icon" href="img/favicon.ico?v=2014-02-24-4" />
        <link rel="stylesheet" type="text/css" href="css/bootstrap_min.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/bootstrap_responsive_min.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/style.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/plugins/daterangepicker/daterangepicker.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/todc_bootstrap_button.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/plugins/chosen/chosen.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/themes.css?2014-02-24-4" media="all" />
		<link rel="stylesheet" type="text/css" href="css/inside.css?2014-02-24-4" media="all" />
		<script type="text/javascript" src="src/jQuery.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/bootstrap_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/validation/jquery_validate_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/validation/jquery_validate_methods.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/form/jquery_form_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/daterangepicker/moment_min.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/daterangepicker/daterangepicker.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/inside.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/insert_text.js?2014-02-24-4"></script>
		<script type="text/javascript" src="src/plugins/chosen/chosen_jquery_min.js?2014-02-24-4"></script>
		<title>奈斯伙伴（Weimob）—国内最大的微信公众服务平台</title>
        <!--[if IE 7]>
            <link href="css/font_awesome_ie7.css?v=2014-02-24-4" rel="stylesheet" />
        <![endif]-->
        <!--[if lte IE 8]>
            <script src="js/excanvas_min.js?v=2014-02-24-4"></script>
        <![endif]-->
        <!--[if lte IE 9]>
            <script src="js/watermark.js?v=2014-02-24-4"></script>
        <![endif]-->
    </head>
        <div id="main">
        <div class="container-fluid">

            <div class="row-fluid">
                <div class="span12">

                    <div class="box">
                        <div class="box-title">
                            <div class="span10">
                                <h3><i class="icon-edit"></i>添加积分兑换</h3>
                            </div>
                        </div>

                        <div class="box-content">
                            <form action="/newmembercard/EditExchange" method="post" class="form-horizontal form-validate">
                            	<input type="hidden" name="aid" value="74461"/>
                            	<input type="hidden" name="id" value=""/>
                                <div class="control-group">
                                    <label for="title" class="control-label">活动名称：</label>
                                    <div class="controls">
                                        <input type="text" name="title" id="title" value="" class="input-large" data-rule-required="true" /><span class="maroon">*</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="time">活动时间</label>
                                    <div class="controls">
                                        <div class="input-prepend">
                                            <span class="add-on"><i class="icon-calendar"></i></span>
                                            <input type="text" name="time" readonly="" id="time"  class="daterangepick input-xlarge" data-rule-required="true" />
                                        </div>
                                        <span class="maroon">*</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">选择人群</label>
                                    <div class="controls">

                                        <label class="radio inline">
                                            <input type="radio" name="crowd_type" value="0"  checked="checked"  >所有会员
                                        </label>
                                                                            </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="djifen">兑换所需积分</label>
                                    <div class="controls inline">
                                        <input type="text" name="integral" id="integral" value="" class="input-mini" data-rule-positiveInteger="true" data-rule-integer="true">
                                        <span class="help-inline">必须为正整数</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="djifen">兑换次数</label>
                                    <div class="controls inline">
                                        <input type="text" name="numbertime" id="numbertime" value="" class="input-mini" data-rule-positiveInteger="true" data-rule-integer="true">
                                        <span class="help-inline">必须为正整数</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label" for="time">活动策略</label>
                                    <div class="controls">
                                        <label class="radio">
                                            <input type="radio" name="type" value="0" checked="checked"  data-ty="ticket" />兑换券 
                                            <span id="ticket" class="help-inline">
                                                <select name="ticket_ty" id="ticket_ty" class="input-small" data-rule-required="true"  >
                                                </select>
                                                <select name="ticket_id" id="ticket_id" class="input-medium" data-rule-required="true"  >
                                                </select>
                                            </span>
                                        </label>
                                        <label class="radio">
                                            <input type="radio" name="type" value="1"  data-ty="draw" />兑换抽奖 
                                                <span id="draw" class="help-inline">
	                                                <select name="draw_ty" id="draw_ty" class="input-small" data-rule-required="true" disabled="disabled">
	                                                </select>
	                                                <select name="draw_id" id="draw_id" class="input-medium" data-rule-required="true"  disabled="disabled">
	                                                </select>
	                                            </span>
                                        </label>
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label class="control-label" for="info">短信通知</label>
                                    <div class="controls">
                                        <label class="checkbox">
                                            <input type="checkbox" value="1"  name="ck_msg" id="ck_msg" />需要以短信形式将积分兑换的活动告知会员
                                        </label>
                                       
                                    </div>
                                </div>
                                <div class="control-group __msg">
                                    <label class="control-label" for="send_number">发送预览</label>
                                    <div class="controls">
                                        <input class="input-xlarge" id="send_number" type="text" placeholder="多个号码用,分开" />
                                        <span class="help-inline"><a href="javascript:;" class="btn" id="send_msg" data-loading-text="发送中...">发送</a></span>

                                    </div>
                                </div>
                                <input id="classid" type="hidden" name="classid" />
                                <div class="form-actions">
                                    <button id="bsubmit" type="submit" data-loading-text="提交中..." class="btn btn-primary">保存</button>
                                    <button type="button" class="btn" onclick="Javascript:window.history.go(-1)">取消</button>

                                </div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script type="text/javascript">
        $(function () {

            //券
            var ticket_options = {
                ajax: '/Newmemrecharge/getConsumptiontype?aid=74461'
            };
            var ticket_sel = new G.util.select(ticket_options);

	        ticket_sel.bind('#ticket_ty','');
            ticket_sel.bind('#ticket_id','');
           

            //奖
            var draw_options = {
                ajax: '/Newmembercard/getConsumptiontype?aid=74461'
            };
            var draw_sel = new G.util.select(draw_options);

        	draw_sel.bind('#draw_ty','');
            draw_sel.bind('#draw_id','');
            
            var $is_sms = "";
    		if($is_sms==0){
    			var $this = $(":checkbox[name='ck_msg']:checked");          	
    			$(".__msg").toggle(this.checked)
    		}

            $info = $("#info");
            $("a.add_par").click(function () {
                console.log($(this).data("value"));
                $info.insertAtCaret($(this).data("value"));
            })
            $info.setCaret();
            $info.live("keydown keyup blur", function (e) {
                var content = $(this).val();
                var length = content.length;
                var $words = $("span.words"), $number = $("span.number");
                $words.text(length)
                var f = Math.floor(length / 70) + 1;
                $number.text(f);
            });

            var s = $("#send_msg");
            s.click(function () {
                var n = $("#send_number").val(), t = $("#title").val(), sum =$("#integral").val();
                if (n.length > 0 && t.length > 0 && sum.length > 0) {
                    s.button('loading')
                    $.ajax({
                        url: "/newmembercard/SentMessage",
                        type: "post",
                        dataType: 'json',
                        data: {
	                    	"type":5,
		                    "aid": 74461,
				            "integral": sum,       
		                    "title": title,
		                    "number": n
                        },
                        success: function (data) {
                            G.logic.form.tip(data);//和页面提交返回参数相同
                            s.button('reset');
                        },
                        error: function () {
                            G.ui.tips.info("网络异常请重试..")
                        }
                    });

                } else { G.ui.tips.info("请输入手机号码,活动名称和积分数量不能为空") }
            });


            $("#ck_msg").click(function () {
                $(".__msg").toggle(this.checked)

            })
            $(":radio[name='type']").click(function () {
                var $this = $(this);
                var $ty = $this.data("ty");
                var $$ticket = $("#ticket select"), $$draw = $("#draw select");
                if ($ty == "ticket") {
                     $$ticket.removeAttr("disabled");
                     $$draw.attr("disabled", "disabled");

                } else {
                     $$draw.removeAttr("disabled");
                     $$ticket.attr("disabled", "disabled");
                }
            });
        })
    </script>
	<script>
		window.document.onkeydown = function(e) {
			if ('' == document.activeElement.id) {
				var e=e || event;
　 				var currKey=e.keyCode || e.which || e.charCode;
				if (8 == currKey) {
					return false;
				}
			}
		};
	</script>
</html>