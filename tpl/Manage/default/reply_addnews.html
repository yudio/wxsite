
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="{np::C('Keywords')}" name="Keywords">
	<meta content="{np::C('Description')}" name="Description">
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/bootstrap_min.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/bootstrap_responsive_min.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/style.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/todc_bootstrap.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/themes.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/inside.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/emotion.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/plugins/chosen/chosen.css" media="all" />
<link rel="stylesheet" type="text/css" href="{np::STATICS}/css/resource.css" media="all" />
<script type="text/javascript" src="{np::STATICS}/src/jQuery.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/bootstrap_min.js"></script>
<script type="text/javascript" src="{np::STATICS}/inside.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/emotion.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/plugins/validation/jquery_validate_min.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/plugins/validation/jquery_validate_methods.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/plugins/chosen/chosen_jquery_min.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/plugins/form/jquery_form_min.js"></script>
<script type="text/javascript" src="{np::STATICS}/src/resource.js"></script>
<title>{np::C('site_name')}—{np::C('site_title')}</title>
	<link rel="shortcut icon" href="{np::STATICS}/img/favicon.ico" />
    <!--[if lte IE 9]><script src="{np::STATICS}/src/watermark.js"></script><![endif]-->
	<!--[if IE 7]><link href="{np::STATICS}/css/font_awesome_ie7.css" rel="stylesheet" /><![endif]-->
</head>
<body>
	   <div id="main">
        <div class="container-fluid">

            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-title">
                            <div class="span10">
                                <h3><i class="icon-edit"></i>
编辑图文自定义内容</h3>
                            </div>
                            <div class="span2"><a class="btn" href="Javascript:window.history.go(-1)">返回</a></div>
                        </div>

                        <div class="box-content">
					<form action="/npManage/reply/addnews.act" method="post" class="form-horizontal form-validate">
								                                <div class="control-group">
                                    <label for="keyword" class="control-label">关键词：</label>
                                    <div class="controls">
                                        <input type="text" name="keyword" id="keyword" value="{np:$info.keyword}" data-rule-required="true" data-rule-maxlength="30" class="input-xlarge" title="多个关键词请用空格格开：例如: 美丽 漂亮 好看"><br>多个关键词请用空格格开：例如: 美丽 漂亮 好看
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="control-label">关键词类型：</label>
                                    <div class="controls">
                                        <label class="radio">
                                            <input type="radio" name="match_type"value="1" <empty name="info">checked</empty> <if condition="$info.match_type eq 1">checked="checked"</if> >
                                            完全匹配，用户输入的和此关键词一样才会触发!
                                        </label>
                                        <label class="radio">
                                            <input type="radio" name="match_type" value="2"  <if condition="$info.match_type eq 2">checked="checked"</if> >
                                            包含匹配 (只要用户输入的文字包含本关键词就触发！
                                        </label>
                                    </div>
                                </div>
							                                <div class="control-group">
                                    <label for="title" class="control-label">标题：</label>
                                    <div class="controls">
                                        <input type="text" name="title" id="title" value="{np:$info.title}" data-rule-required="true" data-rule-maxlength="100" class="input-xlarge">
                                        <span class="maroon">*</span>
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label for="picurl" class="control-label">排序id：</label>
                                    <div class="controls">
                                       <input type="text" ata-rule-number="true" class="input-mini" value="{np:$info.sort|default="0"}" size="3" name="sort_id"><span style="color:red;" class="help-inline">(id越大，在所属官网分类文章列表中显示越靠前)</span>

                                    </div>
                                </div>

                                <div class="control-group">
                                    <label for="picurl" class="control-label">图文封面：</label>
                                    <div class="controls">
											<img id="thumb_img" src="{np:$info.pic}" style="max-height:100px;" />
                                            <input id="thumb" type="text" name="pic" value="{np:$info.pic}" class="input-xlarge" readonly="readonly" data-rule-required="true"  />
                                                                                <span class="help-inline"><a class="btn" id="insertimage">选择图文封面</a></span>  建议大小(宽720高400)
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label for="introduction" class="control-label">简介：</label>
                                    <div class="controls">
                                        <textarea id="introduction" name="info" data-rule-required="true" data-rule-maxlength="200" style="width: 580px; height: 100px">{np:$info.info}</textarea><span class="maroon">*</span>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label for="article_class" class="control-label">所属类别：</label>
                                    <div class="controls">
                                        <select name="article_class" class="chosen-select input-medium" data-nosearch="true" id="article_class">
                                           <option value="0" <if condition="$info['classid'] eq 0">selected="selected"</if>>根分类</option>
                                           <volist name="classinfo" id="val">
                                               <option value="{np:$val.id},{np:$val.name}" <if condition="$val['id'] eq $info['classid']">selected="selected"</if>>{np:$val.name}</option>
                                           </volist>
                                        </select>
                                    </div>
                                </div>

                                <div class="control-group">
                                    <label for="showpic" class="control-label">详细页显示图文封面：</label>
                                    <div class="controls">
                                        <label class="radio inline">
                                            <input type="radio" name="showpic"  value="1" <empty name="info">checked</empty> <if condition="$info['showpic'] eq 1">checked</if> >
                                            是
                                        </label>
                                        <label class="radio inline">
                                            <input type="radio" name="showpic" value="0" <if condition="$info['showpic'] eq '0'">checked</if> >
                                            否
                                        </label>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label for="picurl" class="control-label">图文详细页内容：</label>
                                    <div class="controls">
                                        <textarea name="text" id="content" style="width: 700px; height: 300px; visibility: hidden;">{np:$info.text}</textarea>
                                    </div>
									<script>var editor1;</script>
                                    <script src="{np::STATICS}/kindeditor/kindeditor-min.js"></script>
                                    <script src="{np::STATICS}/kindeditor/kindeditor.config.js"></script>
                                    <script type="text/javascript" >
                                        KindEditor.ready(function (K) {
                                            var editor = K.editor({
                                                themeType: "simple",
                                                allowFileManager: true

                                            });
                                            K('#insertimage').click(function () {
                                                editor.loadPlugin('smimage', function () {
                                                    editor.plugin.imageDialog({
                                                        imageUrl: K('#thumb').val(),
                                                        userRoot: '<?php echo substr(md5($_SESSION['uid']),16);?>',
                                                        clickFn: function (url, title, width, height, border, align) {
                                                            K('#thumb').val(url);
                                                            if (K('#thumb_img')) {
                                                                K('#thumb').hide();
                                                                K('#thumb_img').attr('src', url);
                                                                K('#thumb_img').show().css('display','inline');
                                                            }
                                                            editor.hideDialog();
                                                        }
                                                    });
                                                });
                                            });
                                        });

                                    </script>
                                </div>

								<div class="control-group">
                                    <label for="more_graphics_table" class="control-label">多图文：</label>
                                    <div class="controls">
                                        <table class="dataTable-mini" id="more_graphics_table">
                                            <tbody>
                                            <volist name="news" id="vo">
                                            <tr id="more_graphics_tabletr{np:$vo.id}"><td>
                                                <input type="hidden" value="{np:$vo.id}" name="votetouser[0][]">{np:$vo.title}</td>
                                                <td>
                                                    <a class="btn btn-mini del" href="javascript:void(0)"><i class="icon-remove"></i>
                                                    </a>
                                                </td>
                                            </tr>
                                            </volist>
                                            </tbody>
                                        </table>
                                        <button type="button" rel="more_graphics_table" class="btn add-on">添加</button><span style="color:red;" class="help-inline">最多添加9个</span>
                                    </div>
                                </div>
                                <div class="control-group" style="display: none;">
                                    <label for="more_recommended_table" class="control-label">推荐阅读：</label>
                                    <div class="controls">
                                        <table class="dataTable-mini" id="more_recommended_table">
										                                        </table>
                                        <button type="button" rel="more_recommended_table" class="btn add-on">添加</button><span style="color:red;" class="help-inline">最多添加9个</span>

                                    </div>
                                </div>

                                <script src="http://api.map.baidu.com/getscript?v=2.0&ak=T6LUak3ZjSxnl2qVHywtZabi&services=true" type="text/javascript" type="text/javascript"></script>

                               <div id="res_block">
                                    <div class="control-group">
                                        <label class="control-label">图文外链类型:</label>
                                        <div class="controls">
                                            <select id="type" name="type" class="input-medium">
                                             <option value="0">请选择</option>
                                             <volist name="typelist" id="vo">
                                             <option value="{np:$vo.value}" <if condition="$info['type'] eq $vo['value']">selected="selected"</if> >{np:$vo.name}</option>
                                             </volist>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="r_article" class="control-group r-module <if condition="$info['type'] neq 'article'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label"></label>
                                            <div class="controls">
                                                <span class="maroon">分类添加成功后 请添加图文选择此分类 将会列表显示</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="r_link" class="control-group r-module <if condition="$info['type'] neq 'link'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label" for="source_url">页面URL</label>
                                            <div class="controls">
                                                <input type="text" id="source_url" value="{np:$info.link}" class="input-xlarge" name="link" data-rule-required="true" data-rule-url="true" />
                                                <span class="maroon">*</span><span class="help-inline">(必填,必须是正确的URL格式)</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="r_tel" class="control-group r-module <if condition="$info['type'] neq 'tel'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label" for="tel">电话号码</label>
                                            <div class="controls">
                                                <input type="text" id="tel" value="{np:$info.tel}" class="input-large" name="tel" data-rule-required="true" data-rule-phone="true" />
                                                <span class="maroon">*</span><span class="help-inline">(必填,必须是正确的号码)</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="r_business" class="control-group r-module <if condition="$info['type'] neq 'business'">hide</if>">
                                        <label class="control-label">业务类型:</label>
                                        <div class="controls">
                                            <select id="business_func" name="business_type" class="input-medium">
                                                <volist name="businesslist" id="vo">
                                                    <option value="{np:$vo.value}" data-list="false" <if condition="$info['business_type'] eq $vo['value']">selected="selected"</if>>{np:$vo.name}</option>
                                                </volist>
                                            </select>
                                        </div>
                                        <div class="margin-top" style="display:none;">
                                            <label class="control-label">业务:</label>
                                            <div class="controls">
                                                <table class="table table-bordered">
                                                    <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th>业务标题</th>
                                                        <th>触发关键词</th>
                                                        <th>时间段</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    </tbody>
                                                </table>
                                                <div class="record hide"><a href="javascript:;" id="more_activity">加载更多业务...</a></div>
                                                <div class="text-center no-record" style="display:none;">没有正在进行中的业务</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="r_activity" class="control-group r-module <if condition="$info['type'] neq 'activity'">hide</if>"  >
                                        <label class="control-label">活动类型:</label>
                                        <div class="controls">
                                            <select id="act" name="activity_type" onchange="if (100 == $(this).val()) {$('#activity_select_box').hide(); } else {$('#activity_select_box').show(); };">
                                                <volist name="activitylist" id="vo">
                                                    <option value="{np:$vo.value}" data-list="false" <if condition="$info['activity_type'] eq $vo['value']">selected="selected"</if>>{np:$vo.name}</option>
                                                </volist>
                                            </select>
                                        </div>
                                        <div  class="margin-top" id="activity_select_box" >
                                            <label class="control-label">活动选择:</label>
                                            <div class="controls">
                                                <table class="table table-bordered">
                                                    <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th>活动标题</th>
                                                        <th>触发关键词</th>
                                                        <th>活动时间</th>
                                                    </tr>
                                                    </thead>
                                                </table>
                                                <div class="text-center no-record" style="display:block">没有正在进行中的活动</div>

                                                <div class="record hide"><a href="javascript:;" id="more_activity">加载更多活动...</a></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="r_map" class="control-group r-module <if condition="$info['type'] neq 'map'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label" for="suggestId">经纬度</label>
                                            <div class="controls">
                                                <div class="input-append">
                                                    <input type="text" id="suggestId" name="place" value="{np:$info.place}" class="input-xlarge" data-rule-required="true" />
                                                    <button class="btn" type="button" id="positioning">搜索</button>
                                                </div>
                                                <span class="maroon">注意：这个只是模糊定位，准确位置请地图上标注!</span>
                                                <div id="l-map">
                                                    <i class="icon-spinner icon-spin icon-large"></i>地图加载中...
                                                </div>
                                                <div id="r-result">
                                                    <input type="text" id="lng" name="lng" value="<if condition="$info['type'] eq 'map'">{np:$info.lng}</if>" />
                                                    <input type="text" id="lat" name="lat" value="<if condition="$info['type'] eq 'map'">{np:$info.lat}</if>" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>




                                    <div id="r_car" class="control-group r-module <if condition="$info['type'] neq 'car'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label" for="suggestId">功能模块</label>
                                            <div class="controls">
                                               <select id="car_func"  name="r_car_function">

                                                <option value="2001" data-list="" >最新资讯</option>
                                                <option value="2002" data-list="" >全部车型</option>
                                                <option value="2003" data-list="" >联系销售</option>
                                                <option value="2004" data-list="" >预约试驾</option>
                                                <option value="2005" data-list="" >预约保养</option>
                                                <option value="2006" data-list="" >实用工具</option>
                                                <option value="2007" data-list="" >车主关怀</option>

                                            </select>
                                            </div>
                                            <div class="margin-top hide">
                                            <label class="control-label">业务选择:</label>
                                            <div class="controls">
                                                <table class="table table-bordered">
                                                    <thead>
                                                        <tr>
                                                            <th></th>
                                                            <th>预约标题</th>
                                                            <th>触发关键词</th>
                                                            <th>预约时间</th>
                                                        </tr>
                                                    </thead>

                                                    <tbody>
                                                    </tbody>





                                                </table>
                                                <div class="text-center no-record" style="display:block">没有正在进行中的预约</div>
                                            </div>
                                        </div>
                                        </div>
                                    </div>


                                    <div id="r_estate" class="control-group r-module <if condition="$info['type'] neq 'estate'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label" for="suggestId">功能模块</label>
                                            <div class="controls">
                                               <select id="estate_func" name="r_estate_function">

                                                <option value="1001" data-list="" >楼盘简介</option>
                                                <option value="1002" data-list="" >精美相册</option>
                                                <option value="1003" data-list="" >楼盘印象</option>
                                                <option value="1004" data-list="" >360全景</option>

                                            </select>
                                            </div>

                                        </div>
                                    </div>




                                    <div id="r_food" class="control-group r-module <if condition="$info['type'] neq 'food'">hide</if>">
                                        <div class="control-group">
                                            <label class="control-label" for="suggestId">功能模块</label>
                                            <div class="controls">
                                               <select id="food_func" name="r_food_function">

                                                <option value="3001" data-list="" >选择门店</option>
                                                <option value="3002" data-list="" >全部菜品</option>
                                                <option value="3003" data-list="" >套餐选择</option>
                                                <option value="3004" data-list="" >我的菜单</option>
                                                <option value="3005" data-list="" >我的订单</option>

                                            </select>
                                            </div>

                                        </div>
                                    </div>




                                    <div id="r_vshop" class="control-group r-module <if condition="$info['type'] neq 'vshop'">hide</if>">
                                        <div class="control-group">
                                            <label for="suggestId" class="control-label">功能模块</label>
                                            <div class="controls">
                                                <select name="r_vshop_function" id="vshop_func">
                                                <option value="4001" data-list="" >首页</option>
                                                <option value="4002" data-list="" >会员中心</option>
                                                <option value="4003" data-list="" >购物车</option>
                                                <option value="4004" data-list="" >品牌介绍</option>
                                                <option value="4005" data-list="" >全部分类</option>
                                                </select>
                                            </div>

                                        </div>
                                    </div>



                                    <div id="r_vtg" class="control-group r-module <if condition="$info['type'] neq 'vtg'">hide</if>">
                                        <div class="control-group">
                                            <label for="suggestId" class="control-label">功能模块</label>
                                            <div class="controls">
                                                <select name="r_vtg_function" id="vtg_func">
                                                <option value="6001" data-list="" >首页</option>
                                                <option value="6002" data-list="" >团购券</option>
                                                </select>
                                            </div>

                                        </div>
                                    </div>



                                    <div id="r_vlife" class="control-group r-module <if condition="$info['type'] neq 'vlife'">hide</if>">
                                        <div class="control-group">
                                            <label for="suggestId" class="control-label">功能模块</label>
                                            <div class="controls">
                                                <select name="r_vlife_function" id="vlife_func">

                                                </select>
                                            </div>

                                        </div>
                                    </div>





                                <div class="form-actions">
									<input type="hidden" name="id" id="tid" value="{np:$info.id}">
                                    <button type="submit" class="btn btn-primary" id="bsubmit">保存</button>
									<a class="btn" href="Javascript:window.history.go(-1)">取消</a>

                                </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title"><i class="icon-table"></i>选择图文集</h4>
                    </div>
                    <div class="modal-body">
                        <div class="row-fluid">
                            图文标题：<input name="key" id="key" type="text" class="input-medium" placeholder="输入标题进行查找" />

                            <select name="classid" id="classid" class="input-medium">
                                <option value="0" selected="selected">根分类</option>
                            </select>
                            <button type="button" class="btn" id="_soso"><strong>查找</strong></button>
                        </div>
                        <p></p>

                        <div class="row-fluid">
                            <input type="checkbox" id="chkall" name="chkall" />
                            全选　共有 <span class="red" id="count_num">0</span> 条符合条件
                            <button type="button" class="btn btn-mini" id="p_page"><strong>上一页</strong></button>
                            <span id="p_page_str">第1页/共1页</span>
                            <button type="button" class="btn btn-mini" id="n_page"><strong>下一页</strong></button>
                            <ul class="unstyled list-li-border" id="data-list"></ul>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" data-dismiss="modal">确定</button>
                    </div>

<script type="text/javascript">

                    $(document).ready(function () {


                        var resource = Resource.create();
                        var ins = Resource.instance['res_block'];
                        ins.result = ins.result || {};

                        <if condition="$info['type'] eq 'map'">
                        ins.map = {
                            lat: {np:$info.lat},
                            lng: {np:$info.lng},
                            adr: "{np:$info.place}"
                        }
                        ins._loadBaidu_map();
                        </if>







                        var _pdata_table_id;
                        var _isoso = false;
                        $("#chkall").click(function () {
                            var $idsCheck = $("#data-list input[name='check']")
                            var $this = $(this);
                            if ($this.attr("checked")) {
                                $idsCheck.attr("checked", true);
                            } else {
                                $idsCheck.attr("checked", false);
                            }
                            $idsCheck.each(function () {
                                _tr($(this));
                            });

                        });
                        $("#_soso").click(function () { _isoso = true; $("#_soso").attr("disabled", ""); _page(1) });
                        $("#classid").change(function () { _this_page = 1; _page(1) });
                        $("#data-list input[name='check']").live("click", function () { _tr($(this)); });
                        var _tr = function (_t) {
                            var $this = _t;
                            var $title = $this.attr("t");
                            var $id = $this.val();
                            var $selecttr = $("#" + _pdata_table_id + "tr" + $id + "");
                            if ($this.attr("checked")) {
                                if ($selecttr.length == 0 && $("#" + _pdata_table_id + " tr").length < 9) {
                                    var t = (_pdata_table_id == "more_graphics_table") ? "votetouser[0][]" : "votetouser[1][]";
                                    var _trtmp = "<tr id='" + _pdata_table_id + "tr" + $id + "'><td><input type='hidden' name='" + t + "'  value='" + $id + "' />" + $title + "</td><td><a href='javascript:void(0)' class='btn btn-mini del'><i class='icon-remove'></i></a></td></tr>";
                                    $("#" + _pdata_table_id + "").append(_trtmp);
                                }

                            } else {
                                $selecttr.remove();
                            }
                        }
                        //删除
                        $("table.dataTable-mini .del").live("click", function () {
                            $(this).parent().parent().remove();
                        });
                        $("button.add-on").click(function (e) {
                            e.preventDefault();
                            _pdata_table_id = $(this).attr("rel");
                            $('#myModal').modal('show');
                            $("#chkall").attr("checked", false);
                            _page(1);
                        });
                        $("#p_page").click(function () {
                            if (_this_page - 1 > 0) {
                                _this_page--;
                                _page(_this_page);
                            }
                        });
                        $("#n_page").click(function () {
                            if (_this_page + 1 <= _this_page_count) {
                                _this_page++;
                                _page(_this_page);
                            }
                        });
                        var _this_page = 1;//当前页
                        var _this_page_count = 0;//总页数
                        var _page = function (_index) {
                            var key;
                            if (_isoso) {
                                key = $("#key").val();
                            }
                            var classid = $("#classid").val();
                            $.get("/npManage/reply/getjsonnews.act", {"key": key, "classid": classid, "page": _index, "aid":$('#aid').val(), "tid":$('#tid').val() }, function (data, textStatus) {
                                $("#data-list").html("");
                                //console.log(data.list);
                                $.each(data.list, function (index, item) {
                                    //console.log(index);
                                    var _li_tmp = '<li> <label> <input type="checkbox" name="check" t="' + item.title + '" value="' + item.id + '" />  ' + item.title + '</label></li>';
                                    $("#data-list").append(_li_tmp);

                                });
                                _this_page_count = data.count;
                                $("#count_num").text(_this_page_count * 9);
                                $("#p_page_str").text("第" + _this_page + "页/共" + _this_page_count + "页");
                                $("#_soso").removeAttr("disabled")
                            }, "json");
                        }

                    })

                </script>
				</form>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div></body>
</html>
