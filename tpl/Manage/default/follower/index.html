
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta content="{np::C('Keywords')}" name="Keywords">
    <meta content="{np::C('Description')}" name="Description">
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/bootstrap_min.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/bootstrap_responsive_min.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/style.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/todc_bootstrap.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/themes.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/plugins/chosen/chosen.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/inside.css" media="all" />
    <script type="text/javascript" src="{np::STATICS}/src/jQuery.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/bootstrap_min.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/inside.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/plugins/chosen/chosen_jquery_min.js"></script>
    <title>{np::C('site_name')}—{np::C('site_title')}</title>
    <link rel="shortcut icon" href="{np::STATICS}/img/favicon.ico" />
    <!--[if lte IE 9]><script src="{np::STATICS}/src/watermark.js"></script><![endif]-->
    <!--[if IE 7]><link href="{np::STATICS}/css/font_awesome_ie7.css" rel="stylesheet" /><![endif]-->
</head>
<body>

<style type="text/css">
    a.tag {
        font-size: 12px;
        min-height: 27px;
        display: inline-block;
        line-height: 27px;
        padding: 0 10px;
        position: relative;
        background-color: #fff;
        border-radius: 2px;
        margin: 0 7px 8px 0;
        border: 1px solid #aaa;
        cursor: pointer;
        color: rgb(102, 102, 102);
        text-decoration: none;
    }

    a.tag:hover {
        background-color: #eaeaea;
    }

    a.tag_select, .tag_wrap .tag_select:hover {
        color: #b46e00;
        background-color: #ffe690;
        border: 1px solid #e7b75b;
    }
</style>

<div id="main">
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">
                <div class="box">
                    <div class="box-title">
                        <div class="span8">
                            <h3><i class="icon-table"></i>用户列表 <small>根据</small></h3>
                        </div>
                    </div>
                    <div class="box-content">

                        <div class="row-fluid">
                            <div class="span12 control-group">
                                <div class="span3">
                                    <if condition="$wxtype gt 1"><a class="btn" href="/npManage/Follower/import.act"><i class="icon-plus"></i>导入微信用户</a></if>
                                    <a class="btn" href="javascript:location.reload()"><i class="icon-refresh"></i>刷新</a>
                                </div>
                                <div class="pull-left datatabletool">
                                    <a class="btn" attr="BatchDel" title="删除"><i class="icon-trash"></i>删除</a>
                                </div>
                            </div>

                        </div>

                        <div class="row-fluid" style="display: none;">

                            <div class="span8 control-group">
                                <span>标签筛选：</span>
                                <a href="/userpanel/customer?aid=113625&tag=-10" class="tag tag_select">不限</a>
                                <!-- <h5 >分组名称：[今天新增客户]  分组成员：60人</h5>-->
                            </div>
                            <div class="span4">
                                <div class="form-horizontal">

                                    <input type="text" name="keywords" id="keyword-input" value="" class="input-medium" placeholder="微信名,地区" data-rule-required="true" />

                                    <button class="btn" id="btn_search">查询</button>
                                </div>
                            </div>

                        </div>
                        <div class="row-fluid  control-group" style="display: none;"><a class="btn btn-primary" id="set_all_customer" title="给选中用户添加标签"><i class="icon-tag"></i>给选中用户添加标签</a></div>
                        <div class="row-fluid dataTables_wrapper">

                            <table id="listTable" class="table table-bordered table-hover dataTable">

                                <thead>
                                <tr>
                                    <th class='with-checkbox'>
                                        <input type="checkbox" class="check_all" /></th>
                                    <th>微信名</th>
                                    <th>关注时间</th>
                                    <th>地区</th>
                                    <th>来源</th>
                                    <th>标签</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <volist name="list" id="vo">
                                    <tr>
                                        <td class="with-checkbox">
                                            <input type="checkbox" name="check" value="{np:$vo.id}" /></td>
                                        <td>{np:$vo.nickname}</td>
                                        <td>{np:$vo.subscribe_time|date='Y-m-d H:i:s',###}</td>
                                        <td>{np:$vo.province}-{np:$vo.city}</td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    </volist>
                                </tbody>

                            </table>
                            <div class="dataTables_paginate paging_full_numbers"><span>{np:$page}</span></div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" data-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title"><i class="icon-tag"></i>选择标签</h4>
            </div>
            <div class="modal-body" style="overflow: visible">
                <div class="row-fluid">
                    <select name="set_tag" id="set_tag"  class="input-xxlarge chosen-select" multiple="multiple" data-placeholder="选择标签">
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="tag_set">确定</button>
                <button class="btn" data-dismiss="modal" aria-hidden="true">取消 </button>
            </div>
            <input type="hidden" id="customer_id" />
        </div>
        <script type="text/javascript">

            $(document).ready(function () {
                $("a.tag-set").click(function (e) {
                    e.preventDefault();
                    var $cid = $(this).data("cid"), $tid = $(this).data("tid");
                    console.log($cid);
                    $("#set_tag option").each(function () {
                        var t = $(this);
                        var f = $(this).val();
                        if ($.inArray(eval(f), $tid)!=-1) { t.attr("selected", true); } else { t.attr("selected", false); }
                    });
                    $("#customer_id").val($cid);
                    $("#set_tag").trigger("liszt:updated");
                    $('#myModal').modal('show');

                });
                $("#set_all_customer").click(function (e) {
                    e.preventDefault();
                    var $set_items = $('#listTable tbody .checked');
                    var $len = $set_items.length;
                    $("#set_tag option").each(function () { $(this).attr("selected", false); });
                    $("#set_tag").trigger("liszt:updated");
                    //if (0 == $len) { G.ui.tips.info('请先选择要添加标签的客户'); return; } else {
                    var c = new Array;
                    $set_items.each(function () { c.push($(this).data("cid")) });
                    $("#customer_id").val(c.join(","));
                    $('#myModal').modal('show');
                    // }
                });
                $("#tag_set").click(function () {
                    var $set_tag = $("#set_tag").val(), $this = $(this);
                    //if ($set_tag) {
                    $this.text("提交中...").addClass("disabled").attr("disabled", "disabled");
                    $.ajax({
                        url: "/userpanel/settag",
                        type: "post",
                        dataType: 'json',
                        data: {
                            "aid":113625,
                            "customer_id": $("#customer_id").val(),
                            "set_tag": $set_tag
                        },
                        success: function (data) {
                            alert(data.error);
                            $this.text("确定").removeClass("disabled").removeAttr("disabled");
                            $('#myModal').modal('hide');

                        },
                        error: function () {
                            alert("设置失败....");
                            $this.text("重试").removeClass("disabled").removeAttr("disabled");
                        }
                    });
                    // } else {
                    //    alert("请选择标签..");
                    // }
                });


                $("#btn_search").click(function(){
                    var keywords = $.trim($('#keyword-input').val());
                    /*
                     if (keywords.length <= 0) {
                     alert('请输入搜索关键字.');
                     $('#keyword-input').focus();
                     return false;
                     }*/
                    window.location.href = '/userpanel/customer?aid=113625&tag=-10&keywords=' + keywords;

                });

                $("#keyword-input").keyup(function(e) {
                    if (e.keyCode == 13) {
                        $("#btn_search").click();
                        return false;
                    }
                }).click(function(){
                            $(this).val('');
                        });




            })
        </script>
    </div>

</div></body>
</html>
