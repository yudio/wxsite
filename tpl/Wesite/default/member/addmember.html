<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/member/main.css" media="all" />
    <link rel="stylesheet" type="text/css" href="{np::STATICS}/css/member/dialog.css" media="all" />
    <script type="text/javascript" src="{np::STATICS}/src/member/lib/jquery_min.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/member/js/mymain.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/member/lib/dialog_min.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/member/lib/dater_min.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/member/js/main.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/member/lib/aSelect.js"></script>
    <script type="text/javascript" src="{np::STATICS}/src/member/lib/aLocation.js"></script>
    <title>会员卡</title>
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
    <meta name="Keywords" content="{np::C('Keywords')}" />
    <meta name="Description" content="{np::C('Description')}" />
    <!-- Mobile Devices Support @begin -->
    <meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
    <meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
    <meta content="no-cache" http-equiv="pragma">
    <meta content="0" http-equiv="expires">
    <meta content="telephone=no, address=no" name="format-detection">
    <meta name="apple-mobile-web-app-capable" content="yes" /> <!-- apple devices fullscreen -->
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <!-- Mobile Devices Support @end -->
    <link rel="shortcut icon" href="{np::STATICS}/img/favicon.ico" />
</head>
<body onselectstart="return true;" ondragstart="return false;">
<script>
    $().ready(function(){
        <!-- 系统字段生日是否必填-->
        <if condition="$infoset['birthday_is_must'] eq 1">
        new dater({
            selectYear:document.getElementById("selectYear"),
            selectMonth:document.getElementById("selectMonth"),
            selectDate:document.getElementById("selectDate"),
            minDat: new Date("1900/1/1"),
            maxDat: new Date()
        }).init();
        </if>
    });
    function bd(){
        var d = new iDialog();
        d.open({
            classList: "valid_phone bd",
            title:"",
            close:"",
            content:'<ul class="list_ul_card">\
<form id="form2" action="javascript:;" method="post">\
<li data-card>\
<table>\
<tr class="input wrapInput">\
<td>\
<label class="pre" style="color:#333333;"> 实体卡手机号：</label> \
</td>\
<td style="width:100%;">\
<input type="tel" name="entry_telephone" placeholder="请输入手机号码" maxlength="15" class="input" />\
</td>\
</tr>\
<tr class="input wrapInput">\
<td style="width:100%;">\
<input type="number" placeholder="验证码：" name="entry_checkcode" maxlength="10" class="input" />\
</td>\
<td>\
<input type="button" onclick="getReceiveMemberCardVCode(this, event,\'form2\', \'entry_telephone\');" class="button vcode" value="获取验证码" />\
</td>\
</tr>\
</table>\
</li>\
</form>\
</ul>',
            btns:[
                {id:"", name:"确定", onclick:"fn.call();", fn: function(self){
//alert("queding");
                    submit2();
                }},
                {id:"", name:"取消", onclick:"fn.call();", fn: function(self){
                    self.die();
                }}
            ]
        });
    }
    function submit2(){
        var form = document.getElementById("form2");
        if(form.entry_telephone.value == ""){
            alert("请输入手机号码。",1500);
            return;
        }
        if(form.entry_checkcode.value == "" || form.entry_checkcode.value.length != 6){
            alert("验证码格式不正确。",1500);
            return;
        }
        loading(true);
        $.ajax({
            url: "/Webnewmembercard/BindEntityCard?pid=101281&wechatid=o_bv2t14U7PS2WSTkbbbbannGk",
            type:"POST",
            data:$("#form2").serialize(),
            dataType:"json",
            success: function(res){
                loading(false);
                if(res.errno == 0){
                    alert(res.error, 1500);
                    redirect(res.url,1500);
                }else{
                    alert(res.error, 1500);
                    loading(false);
                }
            }
        });
    }
    function submit1(){
        var form = document.getElementById("form1");
        var obj = {
            username: form.truename.value,
            telephone: form.tel.value
        }
        if(obj.username.length<2){
            alert("请输入姓名,不少于2个字符", 1500);
            return;
        }
        if(obj.telephone.length!=11){
            alert("请输入正确的手机号", 1500);
            return;
        }
        if (!/^[0-9]{8,20}$/.test(obj.telephone)){
            alert("请输入正确的手机号", 1500);
            return;
        }
        loading(true);
        $.ajax({
            url: "/Webmember/{np:$wxuid}/addMember?wecha_id={np:$wecha_id}",
            type:"POST",
            data:$("#form1").serialize(),
            dataType:"json",
            success: function(res){
                loading(false);
                if(res.errno == 0){
                    alert(res.error, 1500);
                    redirect(res.url,1500);
                }else{
                    alert(res.error, 1500);
                    loading(false);
                }
            }
        });
    }
</script>
<div class="container info_tx">
    <div class="body pt_10">
        <ul class="list_ul_card">
            <form id="form1" action="javascript:;" method="post">
                <li data-card>
                    <header class="center">
                        <label style="display:inline-block;"><span>&nbsp;</span>填写会员卡资料</label>
                    </header>
                    <div class="forms">
                        <dl>
                            <dt>姓 名： </dt>
                            <dd><input type="text" name="truename" placeholder="请输入姓名" maxlength="30" class="input"/></dd>
                        </dl>
                        <dl>
                            <dt>手 机：</dt>
                            <dd><input type="tel" name="tel" placeholder="请输入手机号码" maxlength="30" class="input"/></dd>
                        </dl>
                        <!-- 系统字段性别是否必填-->
                        <if condition="$infoset['gender_is_must'] eq 1">
                        <dl>
                            <dt>性 别： </dt>
                            <dd>
                                <select name="gender" class="select" id="selectGender" style="width:100%;">
                                    <option value="0">请选择你的性别</option>
                                    <option value="1">男</option>
                                    <option value="2">女</option>
                                </select>
                            </dd>
                        </dl>
                        </if>
                        <!-- 系统字段生日是否必填-->
                        <if condition="$infoset['birthday_is_must'] eq 1">
                        <dl>
                            <dt>生 日：</dt>
                            <dd>
                                <div class="box select_box">
                                    <div>
                                        <select name="birth_year" class="select" id="selectYear"><!--auth Eric_wu--></select>
                                    </div>
                                    <div>
                                        <select name="birth_month" class="select" id="selectMonth"><!--auth Eric_wu--></select>
                                    </div>
                                    <div>
                                        <select name="birth_date" class="select" id="selectDate"><!--auth Eric_wu--></select>
                                    </div>
                                </div>
                            </dd>
                        </dl>
                        </if>
                        <!-- 系统字段地址是否必填-->
                        <if condition="$infoset['address_is_must'] eq 1">
                        <dl>
                            <dt>地 区：</dt>
                            <dd>
                                <div class="box select_box">
                                    <div>
                                        <select name="province" class="select" id="selectProvince" style="width:100%!important;"><!--auth Eric_wu--></select>
                                    </div>
                                    <div>
                                        <select name="city" class="select" id="selectCity" style="width:100%!important;"><!--auth Eric_wu--></select>
                                    </div>
                                    <div>
                                        <select name="town" class="select" id="selectArea" style="width:100%!important;"><!--auth Eric_wu--></select>
                                    </div>
                                </div>
                            </dd>
                            <script>
                                var sel = aSelect({data: aLocation});
                                sel.bind('#selectProvince', '110000');
                                sel.bind('#selectCity', '110100');
                                sel.bind('#selectArea', '110101');
                            </script>
                        </dl>
                        <dl>
                            <dt>详细地址： </dt>
                            <dd><input type="text" name="address" placeholder="请输入详细地址" maxlength="50"  class="input"/></dd>
                        </dl>
                        </if>
                        <!-- 自定义字段必填项-->
                    </div>
                </li>
                <ul class="add_op">
                    <li style="padding:10px 0 0;">
                        <a href="javascript:submit1();" style="width:100%;">提&nbsp;&nbsp;&nbsp;交</a>
                    </li>
                    <li>
                        <a href="javascript:bd();" class="btn_2" style="width:100%;display: none;">绑定已有实体卡</a>
                    </li>
                </ul>
            </form>
        </ul>
    </div>
</div>
<script type="text/javascript">
    var intervalId,buttonObj;
    //发送下一条短信需要间隔的秒数
    var seconds = 60;
    function getReceiveMemberCardVCode(clickObj, evt, formId, teleName){
        var pid = 101281;
        var form = document.getElementById(formId);
        var req = {
            telephone: $.trim(form[teleName].value),
            pid:pid
        }
        if(!req.telephone){
            alert("请输入手机号", 1000);return;
        }
        clickObj.setAttribute("disabled", "disabled");
        clickObj.value = "正在发送，请稍候...";
        $.ajax({
            url: "/Webnewmembercard/sendCardCheckCode?pid=101281&wechatid=o_bv2t14U7PS2WSTkbbbbannGk",
            type:"post",
            data:req,
            dataType:"JSON",
            success: function(res){
                if(0 == res.errno){
                    clickObj.value = '验证码发送成功';
                    buttonObj = clickObj;
                    intervalId = setInterval("ticker()",1000);
                }else{
                    alert(res.error, 1500);
                    return false;
                }
            }
        });
    }
    function ticker(){
        seconds --;
        if(seconds > 55){
        //提示消息显示5秒钟
        }else if(seconds>0){
            buttonObj.value = seconds+"秒后可重新获取";
        }else{
            clearInterval(intervalId);
            buttonObj.removeAttribute("disabled");
            buttonObj.value = "获取验证码";
            seconds = 60;
            buttonObj = null;
        }
    }
</script>
<script type="text/javascript">
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        WeixinJSBridge.call('hideToolbar');
    });

    window.shareData = {
        "imgUrl": "",
        "timeLineLink": "http://www.weimob.com/Webnewmembercard/AddMember?pid=101281&wechatid=fromUsername",
        "sendFriendLink": "http://www.weimob.com/Webnewmembercard/AddMember?pid=101281&wechatid=fromUsername",
        "weiboLink": "http://www.weimob.com/Webnewmembercard/AddMember?pid=101281&wechatid=fromUsername",
        "tTitle": "会员卡",
        "tContent": "微时代会员卡，方便携带，永不挂失。",
        "fTitle": "会员卡",
        "fContent": "微时代会员卡，方便携带，永不挂失。",
        "wContent": "微时代会员卡，方便携带，永不挂失。"
    };
</script> <div mark="stat_code" style="width:0px; height:0px; display:none;">
</div>
</body>
<script type="text/javascript">
    if(typeof(window.shareData) == 'undefined'){
        window.shareData = {
            "imgUrl": "",
            "timeLineLink": "http://www.weimob.com/Webnewmembercard/AddMember?pid=101281&wechatid=fromUsername",
            "sendFriendLink": "http://www.weimob.com/Webnewmembercard/AddMember?pid=101281&wechatid=fromUsername",
            "weiboLink": "http://www.weimob.com/Webnewmembercard/AddMember?pid=101281&wechatid=fromUsername",
            "tTitle": document.title,
            "tContent": document.title,
            "fTitle": document.title,
            "fContent": document.title,
            "wContent": document.title
        }
    }
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
// 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function (argv) {
            WeixinJSBridge.invoke('sendAppMessage', {
                "img_url": window.shareData.imgUrl,
                "img_width": "640",
                "img_height": "640",
                "link": window.shareData.sendFriendLink,
                "desc": window.shareData.fContent,
                "title": window.shareData.fTitle
            }, function (res) {
                weimobAfterShare("o_bv2t14U7PS2WSTkbbbbannGk",window.shareData.sendFriendLink,'appmessage');
                _report('send_msg', res.err_msg);
            })
        });
// 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function (argv) {
            WeixinJSBridge.invoke('shareTimeline', {
                "img_url": window.shareData.imgUrl,
                "img_width": "640",
                "img_height": "640",
                "link": window.shareData.timeLineLink,
                "desc": window.shareData.tContent,
                "title": window.shareData.tTitle
            }, function (res) {
//weimobAfterShare("o_bv2t14U7PS2WSTkbbbbannGk",window.shareData.timeLineLink,'timeline');
                _report('timeline', res.err_msg);
            });
        });
// 分享到微博
        WeixinJSBridge.on('menu:share:weibo', function (argv) {
            WeixinJSBridge.invoke('shareWeibo', {
                "content": window.shareData.wContent,
                "url": window.shareData.weiboLink
            }, function (res) {
                weimobAfterShare("o_bv2t14U7PS2WSTkbbbbannGk",window.shareData.weiboLink,'weibo');
                _report('weibo', res.err_msg);
            });
        });
    }, false);
</script>
</html>